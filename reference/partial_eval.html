<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Partially evaluate an expression. — partial_eval • dbplyr</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>
<link href="../tidyverse-2.css" rel="stylesheet">

<!--optional theme-->
<link href="../.css" rel="stylesheet">




<meta property="og:title" content="Partially evaluate an expression. — partial_eval" />
<meta property="og:description" content="This function partially evaluates an expression, using information from
the tbl to determine whether names refer to local expressions
or remote variables. This simplifies SQL translation because expressions
don't need to carry around their environment - all relevant information
is incorporated into the expression." />
<meta property="og:image" content="https://dbplyr.tidyverse.org/logo.png" />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>

  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">dbplyr</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of the <a href="https://tidyverse.org">tidyverse</a></span>
          <span class="version version-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../articles/dbplyr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/backend-2.html">dplyr 2.0.0 backend API</a>
    </li>
    <li>
      <a href="../articles/new-backend.html">Adding a new DBI backend</a>
    </li>
    <li>
      <a href="../articles/reprex.html">Reprexes for dbplyr</a>
    </li>
    <li>
      <a href="../articles/sql.html">Writing SQL with dbplyr</a>
    </li>
    <li>
      <a href="../articles/translation-function.html">Function translation</a>
    </li>
    <li>
      <a href="../articles/translation-verb.html">Verb translation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/04/dbplyr-1-4-0/">Version 1.4.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/01/dbplyr-1-3-0/">Version 1.3.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/01/dbplyr-1-2/">Version 1.2.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2017/06/27/dbplyr-1-1-0/">Version 1.1.0</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/tidyverse/dbplyr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Partially evaluate an expression.</h1>
    <small class="dont-index">Source: <a href='https://github.com/tidyverse/dbplyr/blob/master/R/partial-eval.R'><code>R/partial-eval.R</code></a></small>
    <div class="hidden name"><code>partial_eval.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function partially evaluates an expression, using information from
the tbl to determine whether names refer to local expressions
or remote variables. This simplifies SQL translation because expressions
don't need to carry around their environment - all relevant information
is incorporated into the expression.</p>
    </div>

    <pre class="usage"><span class='fu'>partial_eval</span><span class='op'>(</span><span class='va'>call</span>, vars <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>character</a></span><span class='op'>(</span><span class='op'>)</span>, env <span class='op'>=</span> <span class='fu'>caller_env</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>call</th>
      <td><p>an unevaluated expression, as produced by <code><a href='https://rdrr.io/r/base/substitute.html'>quote()</a></code></p></td>
    </tr>
    <tr>
      <th>vars</th>
      <td><p>character vector of variable names.</p></td>
    </tr>
    <tr>
      <th>env</th>
      <td><p>environment in which to search for local values</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="symbol-substitution"><a class="anchor" href="#symbol-substitution"></a>Symbol substitution</h2>

    


<p><code>partial_eval()</code> needs to guess if you're referring to a variable on the
server (remote), or in the current environment (local). It's not possible to
do this 100% perfectly. <code>partial_eval()</code> uses the following heuristic:</p>
<ul>
<li><p>If the tbl variables are known, and the symbol matches a tbl
variable, then remote.</p></li>
<li><p>If the symbol is defined locally, local.</p></li>
<li><p>Otherwise, remote.</p></li>
</ul>

<p>You can override the guesses using <code><a href='https://rdrr.io/r/base/eval.html'>local()</a></code> and <code>remote()</code> to force
computation, or by using the <code>.data</code> and <code>.env</code> pronouns of tidy evaluation.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>vars</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"year"</span>, <span class='st'>"id"</span><span class='op'>)</span>
<span class='fu'>partial_eval</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>&gt;</span> <span class='fl'>1980</span><span class='op'>)</span>, vars <span class='op'>=</span> <span class='va'>vars</span><span class='op'>)</span>
</div><div class='output co'>#&gt; year &gt; 1980</div><div class='input'>
<span class='va'>ids</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"ansonca01"</span>, <span class='st'>"forceda01"</span>, <span class='st'>"mathebo01"</span><span class='op'>)</span>
<span class='fu'>partial_eval</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span><span class='op'>(</span><span class='va'>id</span> <span class='op'>%in%</span> <span class='va'>ids</span><span class='op'>)</span>, vars <span class='op'>=</span> <span class='va'>vars</span><span class='op'>)</span>
</div><div class='output co'>#&gt; id %in% c("ansonca01", "forceda01", "mathebo01")</div><div class='input'>
<span class='co'># cf.</span>
<span class='fu'>partial_eval</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span><span class='op'>(</span><span class='va'>id</span> <span class='op'>==</span> <span class='va'>.data</span><span class='op'>$</span><span class='va'>ids</span><span class='op'>)</span>, vars <span class='op'>=</span> <span class='va'>vars</span><span class='op'>)</span>
</div><div class='output co'>#&gt; id == ids</div><div class='input'>
<span class='co'># You can use local() or .env to disambiguate between local and remote</span>
<span class='co'># variables: otherwise remote is always preferred</span>
<span class='va'>year</span> <span class='op'>&lt;-</span> <span class='fl'>1980</span>
<span class='fu'>partial_eval</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>&gt;</span> <span class='va'>year</span><span class='op'>)</span>, vars <span class='op'>=</span> <span class='va'>vars</span><span class='op'>)</span>
</div><div class='output co'>#&gt; year &gt; year</div><div class='input'><span class='fu'>partial_eval</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/base/eval.html'>local</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span><span class='op'>)</span>, vars <span class='op'>=</span> <span class='va'>vars</span><span class='op'>)</span>
</div><div class='output co'>#&gt; year &gt; 1980</div><div class='input'><span class='fu'>partial_eval</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>&gt;</span> <span class='va'>.env</span><span class='op'>$</span><span class='va'>year</span><span class='op'>)</span>, vars <span class='op'>=</span> <span class='va'>vars</span><span class='op'>)</span>
</div><div class='output co'>#&gt; year &gt; 1980</div><div class='input'>
<span class='co'># Functions are always assumed to be remote. Use local to force evaluation</span>
<span class='co'># in R.</span>
<span class='va'>f</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='va'>x</span> <span class='op'>+</span> <span class='fl'>1</span>
<span class='fu'>partial_eval</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>&gt;</span> <span class='fu'>f</span><span class='op'>(</span><span class='fl'>1980</span><span class='op'>)</span><span class='op'>)</span>, vars <span class='op'>=</span> <span class='va'>vars</span><span class='op'>)</span>
</div><div class='output co'>#&gt; year &gt; f(1980)</div><div class='input'><span class='fu'>partial_eval</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>&gt;</span> <span class='fu'><a href='https://rdrr.io/r/base/eval.html'>local</a></span><span class='op'>(</span><span class='fu'>f</span><span class='op'>(</span><span class='fl'>1980</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>, vars <span class='op'>=</span> <span class='va'>vars</span><span class='op'>)</span>
</div><div class='output co'>#&gt; year &gt; 1981</div><div class='input'>
<span class='co'># For testing you can also use it with the tbl omitted</span>
<span class='fu'>partial_eval</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span><span class='op'>(</span><span class='fl'>1</span> <span class='op'>+</span> <span class='fl'>2</span> <span class='op'>*</span> <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 1 + 2 * 3</div><div class='input'><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fl'>1</span>
<span class='fu'>partial_eval</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/substitute.html'>quote</a></span><span class='op'>(</span><span class='va'>x</span> <span class='op'>^</span> <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; 1^y</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="tidyverse">
  <p>dbplyr is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="https://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>
    Developed by <a href='http://hadley.nz'>Hadley Wickham</a>, Edgar Ruiz, <a href='https://www.rstudio.com'><img src='https://www.tidyverse.org/rstudio-logo.svg' alt='RStudio' height='24' /></a>.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
   </div>

  


  </body>
</html>


