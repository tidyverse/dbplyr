<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Partially evaluate an expression. — partial_eval • dbplyr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="../tidyverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>
<link href="../tidyverse-2.css" rel="stylesheet">

<meta property="og:title" content="Partially evaluate an expression. — partial_eval" />

<meta property="og:description" content="This function partially evaluates an expression, using information from
the tbl to determine whether names refer to local expressions
or remote variables. This simplifies SQL translation because expressions
don't need to carry around their environment - all revelant information
is incorporated into the expression." />

<meta property="og:image" content="https://dbplyr.tidyverse.org/logo.png" />
<meta name="twitter:card" content="summary" />

<meta name="robots" content="noindex">

<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- google analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-115082821-1');
</script>
  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">dbplyr</a>
        <div class="info">
          <span class="partof">part of the <a href="https://tidyverse.org">tidyverse</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">1.3.0.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../articles/dbplyr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/translation-verb.html">Translation of functions to SQL</a>
    </li>
    <li>
      <a href="../articles/translation-function.html">Translation of dplyr verbs to SQL</a>
    </li>
    <li>
      <a href="../articles/new-backend.html">Creating new backends</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/01/dbplyr-1-3-0/">Version 1.3.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/01/dbplyr-1-2/">Version 1.2.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2017/06/27/dbplyr-1-1-0/">Version 1.1.0</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/tidyverse/dbplyr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Partially evaluate an expression.</h1>
    <small class="dont-index">Source: <a href='https://github.com/tidyverse/dbplyr/blob/master/R/partial-eval.R'><code>R/partial-eval.R</code></a></small>
    <div class="hidden name"><code>partial_eval.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>This function partially evaluates an expression, using information from
the tbl to determine whether names refer to local expressions
or remote variables. This simplifies SQL translation because expressions
don't need to carry around their environment - all revelant information
is incorporated into the expression.</p>
    
    </div>

    <pre class="usage"><span class='fu'>partial_eval</span>(<span class='no'>call</span>, <span class='kw'>vars</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/character'>character</a></span>(), <span class='kw'>env</span> <span class='kw'>=</span> <span class='fu'>caller_env</span>())</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>call</th>
      <td><p>an unevaluated expression, as produced by <code><a href='https://www.rdocumentation.org/packages/base/topics/substitute'>quote()</a></code></p></td>
    </tr>
    <tr>
      <th>vars</th>
      <td><p>character vector of variable names.</p></td>
    </tr>
    <tr>
      <th>env</th>
      <td><p>environment in which to search for local values</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="symbol-substitution"><a class="anchor" href="#symbol-substitution"></a>Symbol substitution</h2>

    
    <p><code>partial_eval()</code> needs to guess if you're referring to a variable on the
server (remote), or in the current environment (local). It's not possible to
do this 100<!-- % perfectly. \code{partial_eval()} uses the following heuristic: --></p>
<ul>
<li><p>If the tbl variables are known, and the symbol matches a tbl
variable, then remote.</p></li>
<li><p>If the symbol is defined locally, local.</p></li>
<li><p>Otherwise, remote.</p></li>
</ul>
    <p>You can override the guesses using <code><a href='https://www.rdocumentation.org/packages/base/topics/eval'>local()</a></code> and <code>remote()</code> to force
computation, or by using the <code>.data</code> and <code>.env</code> pronouns of tidy evaluation.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>vars</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"year"</span>, <span class='st'>"id"</span>)
<span class='fu'>partial_eval</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/substitute'>quote</a></span>(<span class='no'>year</span> <span class='kw'>&gt;</span> <span class='fl'>1980</span>), <span class='kw'>vars</span> <span class='kw'>=</span> <span class='no'>vars</span>)</div><div class='output co'>#&gt; year &gt; 1980</div><div class='input'>
<span class='no'>ids</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='st'>"ansonca01"</span>, <span class='st'>"forceda01"</span>, <span class='st'>"mathebo01"</span>)
<span class='fu'>partial_eval</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/substitute'>quote</a></span>(<span class='no'>id</span> <span class='kw'>%in%</span> <span class='no'>ids</span>), <span class='kw'>vars</span> <span class='kw'>=</span> <span class='no'>vars</span>)</div><div class='output co'>#&gt; id %in% c("ansonca01", "forceda01", "mathebo01")</div><div class='input'>
<span class='co'># cf.</span>
<span class='fu'>partial_eval</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/substitute'>quote</a></span>(<span class='no'>id</span> <span class='kw'>==</span> <span class='no'>.data</span>$<span class='no'>ids</span>), <span class='kw'>vars</span> <span class='kw'>=</span> <span class='no'>vars</span>)</div><div class='output co'>#&gt; id == ids</div><div class='input'>
<span class='co'># You can use local() or .env to disambiguate between local and remote</span>
<span class='co'># variables: otherwise remote is always preferred</span>
<span class='no'>year</span> <span class='kw'>&lt;-</span> <span class='fl'>1980</span>
<span class='fu'>partial_eval</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/substitute'>quote</a></span>(<span class='no'>year</span> <span class='kw'>&gt;</span> <span class='no'>year</span>), <span class='kw'>vars</span> <span class='kw'>=</span> <span class='no'>vars</span>)</div><div class='output co'>#&gt; year &gt; year</div><div class='input'><span class='fu'>partial_eval</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/substitute'>quote</a></span>(<span class='no'>year</span> <span class='kw'>&gt;</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/eval'>local</a></span>(<span class='no'>year</span>)), <span class='kw'>vars</span> <span class='kw'>=</span> <span class='no'>vars</span>)</div><div class='output co'>#&gt; year &gt; 1980</div><div class='input'><span class='fu'>partial_eval</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/substitute'>quote</a></span>(<span class='no'>year</span> <span class='kw'>&gt;</span> <span class='no'>.env</span>$<span class='no'>year</span>), <span class='kw'>vars</span> <span class='kw'>=</span> <span class='no'>vars</span>)</div><div class='output co'>#&gt; year &gt; 1980</div><div class='input'>
<span class='co'># Functions are always assumed to be remote. Use local to force evaluation</span>
<span class='co'># in R.</span>
<span class='no'>f</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) <span class='no'>x</span> + <span class='fl'>1</span>
<span class='fu'>partial_eval</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/substitute'>quote</a></span>(<span class='no'>year</span> <span class='kw'>&gt;</span> <span class='fu'>f</span>(<span class='fl'>1980</span>)), <span class='kw'>vars</span> <span class='kw'>=</span> <span class='no'>vars</span>)</div><div class='output co'>#&gt; year &gt; f(1980)</div><div class='input'><span class='fu'>partial_eval</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/substitute'>quote</a></span>(<span class='no'>year</span> <span class='kw'>&gt;</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/eval'>local</a></span>(<span class='fu'>f</span>(<span class='fl'>1980</span>))), <span class='kw'>vars</span> <span class='kw'>=</span> <span class='no'>vars</span>)</div><div class='output co'>#&gt; year &gt; 1981</div><div class='input'>
<span class='co'># For testing you can also use it with the tbl omitted</span>
<span class='fu'>partial_eval</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/substitute'>quote</a></span>(<span class='fl'>1</span> + <span class='fl'>2</span> * <span class='fl'>3</span>))</div><div class='output co'>#&gt; 1 + 2 * 3</div><div class='input'><span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>
<span class='fu'>partial_eval</span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/substitute'>quote</a></span>(<span class='no'>x</span> ^ <span class='no'>y</span>))</div><div class='output co'>#&gt; 1^y</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#symbol-substitution">Symbol substitution</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="tidyverse">
  <p>dbplyr is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="https://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>
    Developed by <a href='http://hadley.nz'>Hadley Wickham</a>, Edgar Ruiz, <a href='https://www.rstudio.com'><img src='https://www.tidyverse.org/rstudio-logo.svg' alt='RStudio' height='24' /></a>.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>
      </footer>
   </div>

  

  </body>
</html>

