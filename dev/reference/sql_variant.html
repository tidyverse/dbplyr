<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create an sql translator — sql_substr • dbplyr</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>
<link href="../tidyverse-2.css" rel="stylesheet">

<!--optional theme-->
<link href="../.css" rel="stylesheet">




<meta property="og:title" content="Create an sql translator — sql_substr" />
<meta property="og:description" content="When creating a package that maps to a new SQL based src, you'll often
want to provide some additional mappings from common R commands to the
commands that your tbl provides. These three functions make that
easy." />
<meta property="og:image" content="https://dbplyr.tidyverse.org/logo.png" />
<meta name="twitter:card" content="summary" />


<meta name="robots" content="noindex">

<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>

  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">dbplyr</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of the <a href="https://tidyverse.org">tidyverse</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">1.99.0.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../articles/dbplyr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/backend-2.html">dplyr 2.0.0 transition guide</a>
    </li>
    <li>
      <a href="../articles/new-backend.html">Adding a new DBI backend</a>
    </li>
    <li>
      <a href="../articles/reprex.html">Reprexes for dbplyr</a>
    </li>
    <li>
      <a href="../articles/sql.html">Writing SQL with dbplyr</a>
    </li>
    <li>
      <a href="../articles/translation-function.html">Function translation</a>
    </li>
    <li>
      <a href="../articles/translation-verb.html">Verb translation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/04/dbplyr-1-4-0/">Version 1.4.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/01/dbplyr-1-3-0/">Version 1.3.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/01/dbplyr-1-2/">Version 1.2.0</a>
    </li>
    <li>
      <a href="https://blog.rstudio.com/2017/06/27/dbplyr-1-1-0/">Version 1.1.0</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/tidyverse/dbplyr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create an sql translator</h1>
    <small class="dont-index">Source: <a href='https://github.com/tidyverse/dbplyr/blob/master/R/translate-sql-string.R'><code>R/translate-sql-string.R</code></a>, <a href='https://github.com/tidyverse/dbplyr/blob/master/R/translate-sql-paste.R'><code>R/translate-sql-paste.R</code></a>, <a href='https://github.com/tidyverse/dbplyr/blob/master/R/translate-sql-helpers.R'><code>R/translate-sql-helpers.R</code></a>, and 2 more</small>
    <div class="hidden name"><code>sql_variant.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>When creating a package that maps to a new SQL based src, you'll often
want to provide some additional mappings from common R commands to the
commands that your tbl provides. These three functions make that
easy.</p>
    </div>

    <pre class="usage"><span class='fu'>sql_substr</span>(f = <span class='st'>"SUBSTR"</span>)

<span class='fu'>sql_str_sub</span>(subset_f = <span class='st'>"SUBSTR"</span>, length_f = <span class='st'>"LENGTH"</span>)

<span class='fu'>sql_paste</span>(<span class='kw'>default_sep</span>, f = <span class='st'>"CONCAT_WS"</span>)

<span class='fu'>sql_paste_infix</span>(<span class='kw'>default_sep</span>, <span class='kw'>op</span>, <span class='kw'>cast</span>)

<span class='fu'>sql_variant</span>(
  scalar = <span class='fu'>sql_translator</span>(),
  aggregate = <span class='fu'>sql_translator</span>(),
  window = <span class='fu'>sql_translator</span>()
)

<span class='fu'>sql_translator</span>(<span class='kw'>...</span>, .funs = <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(), .parent = <span class='fu'><a href='https://rdrr.io/r/base/environment.html'>new.env</a></span>(parent = <span class='fu'><a href='https://rdrr.io/r/base/environment.html'>emptyenv</a></span>()))

<span class='fu'>sql_infix</span>(<span class='kw'>f</span>, pad = <span class='fl'>TRUE</span>)

<span class='fu'>sql_prefix</span>(<span class='kw'>f</span>, n = <span class='kw'>NULL</span>)

<span class='fu'>sql_aggregate</span>(<span class='kw'>f</span>, f_r = <span class='kw'>f</span>)

<span class='fu'>sql_aggregate_2</span>(<span class='kw'>f</span>)

<span class='fu'>sql_aggregate_n</span>(<span class='kw'>f</span>, f_r = <span class='kw'>f</span>)

<span class='fu'>sql_not_supported</span>(<span class='kw'>f</span>)

<span class='fu'>sql_cast</span>(<span class='kw'>type</span>)

<span class='fu'>sql_try_cast</span>(<span class='kw'>type</span>)

<span class='fu'>sql_log</span>()

<span class='fu'>sql_cot</span>()

<span class='kw'>base_scalar</span>

<span class='kw'>base_agg</span>

<span class='kw'>base_win</span>

<span class='kw'>base_no_win</span>

<span class='kw'>base_odbc_scalar</span>

<span class='kw'>base_odbc_agg</span>

<span class='kw'>base_odbc_win</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>f</th>
      <td><p>the name of the sql function as a string</p></td>
    </tr>
    <tr>
      <th>scalar, aggregate, window</th>
      <td><p>The three families of functions than an
SQL variant can supply.</p></td>
    </tr>
    <tr>
      <th>..., .funs</th>
      <td><p>named functions, used to add custom converters from standard
R functions to sql functions. Specify individually in <code>...</code>, or
provide a list of <code>.funs</code></p></td>
    </tr>
    <tr>
      <th>.parent</th>
      <td><p>the sql variant that this variant should inherit from.
Defaults to <code>base_agg</code> which provides a standard set of
mappings for the most common operators and functions.</p></td>
    </tr>
    <tr>
      <th>pad</th>
      <td><p>If <code>TRUE</code>, the default, pad the infix operator with spaces.</p></td>
    </tr>
    <tr>
      <th>n</th>
      <td><p>for <code>sql_infix()</code>, an optional number of arguments to expect.
Will signal error if not correct.</p></td>
    </tr>
    <tr>
      <th>f_r</th>
      <td><p>the name of the r function being translated as a string</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="helper-functions"><a class="anchor" href="#helper-functions"></a>Helper functions</h2>

    


<p><code>sql_infix()</code> and <code>sql_prefix()</code> create default SQL infix and prefix
functions given the name of the SQL function. They don't perform any input
checking, but do correctly escape their input, and are useful for
quickly providing default wrappers for a new SQL variant.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='win_over.html'>win_over()</a></code> for helper functions for window functions.</p>
<p><code><a href='sql.html'>sql()</a></code> for an example of a more customised sql
conversion function.</p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># An example of adding some mappings for the statistical functions that</span>
<span class='co'># postgresql provides: http://bit.ly/K5EdTn</span>

<span class='kw'>postgres_agg</span> <span class='op'>&lt;-</span> <span class='fu'>sql_translator</span>(.parent = <span class='kw'>base_agg</span>,
  cor = <span class='fu'>sql_aggregate_2</span>(<span class='st'>"CORR"</span>),
  cov = <span class='fu'>sql_aggregate_2</span>(<span class='st'>"COVAR_SAMP"</span>),
  sd =  <span class='fu'>sql_aggregate</span>(<span class='st'>"STDDEV_SAMP"</span>, <span class='st'>"sd"</span>),
  var = <span class='fu'>sql_aggregate</span>(<span class='st'>"VAR_SAMP"</span>, <span class='st'>"var"</span>)
)

<span class='co'># Next we have to simulate a connection that uses this variant</span>
<span class='kw'>con</span> <span class='op'>&lt;-</span> <span class='fu'><a href='simulate_hive.html'>simulate_dbi</a></span>(<span class='st'>"TestCon"</span>)
<span class='kw'>sql_translation.TestCon</span> <span class='op'>&lt;-</span> <span class='fu'>function</span>(<span class='kw'>x</span>) {
  <span class='fu'>sql_variant</span>(
    <span class='kw'>base_scalar</span>,
    <span class='kw'>postgres_agg</span>,
    <span class='kw'>base_no_win</span>
  )
}

<span class='fu'><a href='translate_sql.html'>translate_sql</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span>(<span class='kw'>x</span>, <span class='kw'>y</span>), con = <span class='kw'>con</span>, window = <span class='fl'>FALSE</span>)
</div><div class='output co'>#&gt; &lt;SQL&gt; cor(`x`, `y`)</div><div class='input'><span class='fu'><a href='translate_sql.html'>translate_sql</a></span>(<span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span>(<span class='kw'>income</span> <span class='op'>/</span> <span class='kw'>years</span>), con = <span class='kw'>con</span>, window = <span class='fl'>FALSE</span>)
</div><div class='output co'>#&gt; &lt;SQL&gt; sd(`income` / `years`)</div><div class='input'>
<span class='co'># Any functions not explicitly listed in the converter will be translated</span>
<span class='co'># to sql as is, so you don't need to convert all functions.</span>
<span class='fu'><a href='translate_sql.html'>translate_sql</a></span>(<span class='fu'>regr_intercept</span>(<span class='kw'>y</span>, <span class='kw'>x</span>), con = <span class='kw'>con</span>)
</div><div class='output co'>#&gt; &lt;SQL&gt; regr_intercept(`y`, `x`)</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="tidyverse">
  <p>dbplyr is a part of the <strong>tidyverse</strong>, an ecosystem of packages designed with common APIs and a shared philosophy. Learn more at <a href="https://tidyverse.org">tidyverse.org</a>.</p>
</div>

<div class="author">
  <p>
    Developed by <a href='http://hadley.nz'>Hadley Wickham</a>, Edgar Ruiz, <a href='https://www.rstudio.com'><img src='https://www.tidyverse.org/rstudio-logo.svg' alt='RStudio' height='24' /></a>.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
   </div>

  


  </body>
</html>


