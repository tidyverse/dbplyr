<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to dbplyr • dbplyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to dbplyr">
<meta name="robots" content="noindex">
<script defer data-domain="dbplyr.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dbplyr</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">2.5.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/dbplyr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/backend-2.html">dbplyr 2.0.0 backend API</a></li>
    <li><a class="dropdown-item" href="../articles/new-backend.html">Adding a new DBI backend</a></li>
    <li><a class="dropdown-item" href="../articles/reprex.html">Reprexes for dbplyr</a></li>
    <li><a class="dropdown-item" href="../articles/sql.html">Writing SQL with dbplyr</a></li>
    <li><a class="dropdown-item" href="../articles/translation-function.html">Function translation</a></li>
    <li><a class="dropdown-item" href="../articles/translation-verb.html">Verb translation</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2024/04/dbplyr-2-5-0/">Version 2.5.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2023/10/dbplyr-2-4-0/">Version 2.4.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2023/01/dbplyr-2-3-0/">Version 2.3.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2022/06/dbplyr-2-2-0/">Version 2.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2021/02/dplyr-backends/">Version 2.1.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/11/dbplyr-2-0-0/">Version 2.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/04/dbplyr-1-4-0/">Version 1.4.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/01/dbplyr-1-3-0/">Version 1.3.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/01/dbplyr-1-2/">Version 1.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://blog.rstudio.com/2017/06/27/dbplyr-1-1-0/">Version 1.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tidyverse/dbplyr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to dbplyr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/dbplyr/blob/main/vignettes/dbplyr.Rmd" class="external-link"><code>vignettes/dbplyr.Rmd</code></a></small>
      <div class="d-none name"><code>dbplyr.Rmd</code></div>
    </div>

    
    
<p>As well as working with local in-memory data stored in data frames,
dplyr also works with remote on-disk data stored in databases. This is
particularly useful in two scenarios:</p>
<ul>
<li><p>Your data is already in a database.</p></li>
<li><p>You have so much data that it does not all fit into memory
simultaneously and you need to use some external storage
engine.</p></li>
</ul>
<p>(If your data fits in memory there is no advantage to putting it in a
database: it will only be slower and more frustrating.)</p>
<p>This vignette focuses on the first scenario because it’s the most
common. If you’re using R to do data analysis inside a company, most of
the data you need probably already lives in a database (it’s just a
matter of figuring out which one!). However, you will learn how to load
data in to a local database in order to demonstrate dplyr’s database
tools. At the end, I’ll also give you a few pointers if you do need to
set up your own database.</p>
<div class="section level2">
<h2 id="getting-started">Getting started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>To use databases with dplyr you need to first install dbplyr:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"dbplyr"</span><span class="op">)</span></span></code></pre></div>
<p>You’ll also need to install a DBI backend package. The DBI package
provides a common interface that allows dplyr to work with many
different databases using the same code. DBI is automatically installed
with dbplyr, but you need to install a specific backend for the database
that you want to connect to.</p>
<p>Five commonly used backends are:</p>
<ul>
<li><p><a href="https://CRAN.R-project.org/package=RMariaDB" class="external-link">RMariaDB</a> connects
to MySQL and MariaDB</p></li>
<li><p><a href="https://CRAN.R-project.org/package=RPostgres" class="external-link">RPostgres</a>
connects to Postgres and Redshift.</p></li>
<li><p><a href="https://github.com/r-dbi/RSQLite" class="external-link">RSQLite</a> embeds a
SQLite database.</p></li>
<li><p><a href="https://github.com/r-dbi/odbc#odbc" class="external-link">odbc</a> connects to
many commercial databases via the open database connectivity
protocol.</p></li>
<li><p><a href="https://github.com/r-dbi/bigrquery" class="external-link">bigrquery</a>
connects to Google’s BigQuery.</p></li>
</ul>
<p>If the database you need to connect to is not listed here, you’ll
need to do some investigation (i.e. googling) yourself.</p>
<p>In this vignette, we’re going to use the RSQLite backend which is
automatically installed when you install dbplyr. SQLite is a great way
to get started with databases because it’s completely embedded inside an
R package. Unlike most other systems, you don’t need to setup a separate
database server. SQLite is great for demos, but is surprisingly
powerful, and with a little practice you can use it to easily work with
many gigabytes of data.</p>
</div>
<div class="section level2">
<h2 id="connecting-to-the-database">Connecting to the database<a class="anchor" aria-label="anchor" href="#connecting-to-the-database"></a>
</h2>
<p>To work with a database in dplyr, you must first connect to it, using
<code><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">DBI::dbConnect()</a></code>. We’re not going to go into the details of
the DBI package here, but it’s the foundation upon which dbplyr is
built. You’ll need to learn more about if you need to do things to the
database that are beyond the scope of dplyr.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RSQLite</span><span class="fu">::</span><span class="fu"><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">SQLite</a></span><span class="op">(</span><span class="op">)</span>, dbname <span class="op">=</span> <span class="st">":memory:"</span><span class="op">)</span></span></code></pre></div>
<p>The arguments to <code><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">DBI::dbConnect()</a></code> vary from database to
database, but the first argument is always the database backend. It’s
<code><a href="https://rsqlite.r-dbi.org/reference/SQLite.html" class="external-link">RSQLite::SQLite()</a></code> for RSQLite,
<code><a href="https://rmariadb.r-dbi.org/reference/dbConnect-MariaDBDriver-method.html" class="external-link">RMariaDB::MariaDB()</a></code> for RMariaDB,
<code><a href="https://rpostgres.r-dbi.org/reference/Postgres.html" class="external-link">RPostgres::Postgres()</a></code> for RPostgres,
<code><a href="https://odbc.r-dbi.org/reference/dbConnect-OdbcDriver-method.html" class="external-link">odbc::odbc()</a></code> for odbc, and
<code>bigrquery::bigquery()</code> for BigQuery. SQLite only needs one
other argument: the path to the database. Here we use the special string
<code>":memory:"</code> which causes SQLite to make a temporary
in-memory database.</p>
<p>Most existing databases don’t live in a file, but instead live on
another server. That means in real-life that your code will look more
like this:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span><span class="fu">RMariaDB</span><span class="fu">::</span><span class="fu"><a href="https://rmariadb.r-dbi.org/reference/dbConnect-MariaDBDriver-method.html" class="external-link">MariaDB</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>  host <span class="op">=</span> <span class="st">"database.rstudio.com"</span>,</span>
<span>  user <span class="op">=</span> <span class="st">"hadley"</span>,</span>
<span>  password <span class="op">=</span> <span class="fu">rstudioapi</span><span class="fu">::</span><span class="fu">askForPassword</span><span class="op">(</span><span class="st">"Database password"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>(If you’re not using RStudio, you’ll need some other way to securely
retrieve your password. You should never record it in your analysis
scripts or type it into the console. <a href="https://db.rstudio.com/best-practices/managing-credentials" class="external-link">Securing
Credentials</a> provides some best practices.)</p>
<p>Our temporary database has no data in it, so we’ll start by copying
over <code><a href="https://rdrr.io/pkg/nycflights13/man/flights.html" class="external-link">nycflights13::flights</a></code> using the convenient
<code><a href="https://dplyr.tidyverse.org/reference/copy_to.html" class="external-link">copy_to()</a></code> function. This is a quick and dirty way of
getting data into a database and is useful primarily for demos and other
small jobs.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/copy_to.html" class="external-link">copy_to</a></span><span class="op">(</span><span class="va">con</span>, <span class="fu">nycflights13</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/nycflights13/man/flights.html" class="external-link">flights</a></span>, <span class="st">"flights"</span>,</span>
<span>  temporary <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>  indexes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span><span class="op">)</span>, </span>
<span>    <span class="st">"carrier"</span>, </span>
<span>    <span class="st">"tailnum"</span>,</span>
<span>    <span class="st">"dest"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>As you can see, the <code><a href="https://dplyr.tidyverse.org/reference/copy_to.html" class="external-link">copy_to()</a></code> operation has an
additional argument that allows you to supply indexes for the table.
Here we set up indexes that will allow us to quickly process the data by
day, carrier, plane, and destination. Creating the right indices is key
to good database performance, but is unfortunately beyond the scope of
this article.</p>
<p>Now that we’ve copied the data, we can use <code><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl()</a></code> to take
a reference to it:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flights_db</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"flights"</span><span class="op">)</span></span></code></pre></div>
<p>When you print it out, you’ll notice that it mostly looks like a
regular tibble:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flights_db</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   table&lt;`flights`&gt; [?? x 19]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: sqlite 3.50.3 [:memory:]</span></span></span>
<span><span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>013     1     1      517            515         2      830</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>013     1     1      533            529         4      850</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>013     1     1      542            540         2      923</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>013     1     1      544            545        -<span style="color: #BB0000;">1</span>     <span style="text-decoration: underline;">1</span>004</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>013     1     1      554            600        -<span style="color: #BB0000;">6</span>      812</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">2</span>013     1     1      554            558        -<span style="color: #BB0000;">4</span>      740</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   minute &lt;dbl&gt;, time_hour &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The main difference is that you can see that it’s a remote source in
a SQLite database.</p>
</div>
<div class="section level2">
<h2 id="generating-queries">Generating queries<a class="anchor" aria-label="anchor" href="#generating-queries"></a>
</h2>
<p>To interact with a database you usually use SQL, the Structured Query
Language. SQL is over 40 years old, and is used by pretty much every
database in existence. The goal of dbplyr is to automatically generate
SQL for you so that you’re not forced to use it. However, SQL is a very
large language and dbplyr doesn’t do everything. It focusses on
<code>SELECT</code> statements, the SQL you write most often as an
analyst.</p>
<p>Most of the time you don’t need to know anything about SQL, and you
can continue to use the dplyr verbs that you’re already familiar
with:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flights_db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">year</span><span class="op">:</span><span class="va">day</span>, <span class="va">dep_delay</span>, <span class="va">arr_delay</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [?? x 5]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: sqlite 3.50.3 [:memory:]</span></span></span>
<span><span class="co">#&gt;    year month   day dep_delay arr_delay</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>013     1     1         2        11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>013     1     1         4        20</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>013     1     1         2        33</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>013     1     1        -<span style="color: #BB0000;">1</span>       -<span style="color: #BB0000;">18</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>013     1     1        -<span style="color: #BB0000;">6</span>       -<span style="color: #BB0000;">25</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">2</span>013     1     1        -<span style="color: #BB0000;">4</span>        12</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span>
<span></span>
<span><span class="va">flights_db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">dep_delay</span> <span class="op">&gt;</span> <span class="fl">240</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [?? x 19]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: sqlite 3.50.3 [:memory:]</span></span></span>
<span><span class="co">#&gt;    year month   day dep_time sched_dep_time dep_delay arr_time</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>013     1     1      848           <span style="text-decoration: underline;">1</span>835       853     <span style="text-decoration: underline;">1</span>001</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>013     1     1     <span style="text-decoration: underline;">1</span>815           <span style="text-decoration: underline;">1</span>325       290     <span style="text-decoration: underline;">2</span>120</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>013     1     1     <span style="text-decoration: underline;">1</span>842           <span style="text-decoration: underline;">1</span>422       260     <span style="text-decoration: underline;">1</span>958</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>013     1     1     <span style="text-decoration: underline;">2</span>115           <span style="text-decoration: underline;">1</span>700       255     <span style="text-decoration: underline;">2</span>330</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>013     1     1     <span style="text-decoration: underline;">2</span>205           <span style="text-decoration: underline;">1</span>720       285       46</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>  <span style="text-decoration: underline;">2</span>013     1     1     <span style="text-decoration: underline;">2</span>343           <span style="text-decoration: underline;">1</span>724       379      314</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   minute &lt;dbl&gt;, time_hour &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="va">flights_db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">dest</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dep_delay</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Missing values are always removed in SQL aggregation functions.</span></span>
<span><span class="co">#&gt; Use `na.rm = TRUE` to silence this warning</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:   SQL [?? x 2]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database: sqlite 3.50.3 [:memory:]</span></span></span>
<span><span class="co">#&gt;   dest  delay</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ABQ   13.7 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ACK    6.46</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ALB   23.6 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ANC   12.9 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ATL   12.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> AUS   13.0 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span></code></pre></div>
<p>However, in the long-run, I highly recommend you at least learn the
basics of SQL. It’s a valuable skill for any data scientist, and it will
help you debug problems if you run into problems with dplyr’s automatic
translation. If you’re completely new to SQL you might start with this
<a href="https://www.codecademy.com/learn/learn-sql" class="external-link">codeacademy
tutorial</a>. If you have some familiarity with SQL and you’d like to
learn more, I found <a href="https://www.sqlite.org/queryplanner.html" class="external-link">how indexes work in
SQLite</a> and <a href="https://blog.jooq.org/2016/03/17/10-easy-steps-to-a-complete-understanding-of-sql/" class="external-link">10
easy steps to a complete understanding of SQL</a> to be particularly
helpful.</p>
<p>The most important difference between ordinary data frames and remote
database queries is that your R code is translated into SQL and executed
in the database on the remote server, not in R on your local machine.
When working with databases, dplyr tries to be as lazy as possible:</p>
<ul>
<li><p>It never pulls data into R unless you explicitly ask for
it.</p></li>
<li><p>It delays doing any work until the last possible moment: it
collects together everything you want to do and then sends it to the
database in one step.</p></li>
</ul>
<p>For example, take the following code:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tailnum_delay_db</span> <span class="op">&lt;-</span> <span class="va">flights_db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">tailnum</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    delay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">arr_delay</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">delay</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">&gt;</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>Surprisingly, this sequence of operations never touches the database.
It’s not until you ask for the data (e.g. by printing
<code>tailnum_delay</code>) that dplyr generates the SQL and requests
the results from the database. Even then it tries to do as little work
as possible and only pulls down a few rows.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tailnum_delay_db</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Source:     SQL [?? x 3]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Database:   sqlite 3.50.3 [:memory:]</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Ordered by: desc(delay)</span></span></span>
<span><span class="co">#&gt;   tailnum delay     n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> N11119   30.3   148</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> N16919   29.9   251</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> N14998   27.9   230</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> N15910   27.6   280</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> N13123   26.0   121</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> N11192   25.9   154</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ more rows</span></span></span></code></pre></div>
<p>Behind the scenes, dplyr is translating your R code into SQL. You can
see the SQL it’s generating with <code><a href="https://dplyr.tidyverse.org/reference/explain.html" class="external-link">show_query()</a></code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tailnum_delay_db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/explain.html" class="external-link">show_query</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;SQL&gt;</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">SELECT</span> `tailnum`, AVG(`arr_delay`)<span style="color: #0000BB;"> AS </span>`delay`, COUNT(*)<span style="color: #0000BB;"> AS </span>`n`</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">FROM</span> `flights`</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">GROUP BY</span> `tailnum`</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">HAVING</span> (COUNT(*) &gt; 100.0)</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ORDER BY</span> `delay` DESC</span></span></code></pre></div>
<p>If you’re familiar with SQL, this probably isn’t exactly what you’d
write by hand, but it does the job. You can learn more about the SQL
translation in <code><a href="../articles/translation-verb.html">vignette("translation-verb")</a></code> and
<code><a href="../articles/translation-function.html">vignette("translation-function")</a></code>.</p>
<p>Typically, you’ll iterate a few times before you figure out what data
you need from the database. Once you’ve figured it out, use
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> to pull all the data down into a local
tibble:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tailnum_delay</span> <span class="op">&lt;-</span> <span class="va">tailnum_delay_db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tailnum_delay</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,201 × 3</span></span></span>
<span><span class="co">#&gt;   tailnum delay     n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> N11119   30.3   148</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> N16919   29.9   251</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> N14998   27.9   230</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> N15910   27.6   280</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> N13123   26.0   121</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> N11192   25.9   154</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,195 more rows</span></span></span></code></pre></div>
<p><code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> requires that database does some work, so it
may take a long time to complete. Otherwise, dplyr tries to prevent you
from accidentally performing expensive query operations:</p>
<ul>
<li><p>Because there’s generally no way to determine how many rows a
query will return unless you actually run it, <code><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow()</a></code> is
always <code>NA</code>.</p></li>
<li><p>Because you can’t find the last few rows without executing the
whole query, you can’t use <code><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail()</a></code>.</p></li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tailnum_delay_db</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">tailnum_delay_db</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `tail()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `tail()` is not supported on database backends.</span></span></code></pre></div>
<p>You can also ask the database how it plans to execute the query with
<code><a href="https://dplyr.tidyverse.org/reference/explain.html" class="external-link">explain()</a></code>. The output is database dependent, and can be
esoteric, but learning a bit about it can be very useful because it
helps you understand if the database can execute the query efficiently,
or if you need to create new indices.</p>
</div>
<div class="section level2">
<h2 id="creating-your-own-database">Creating your own database<a class="anchor" aria-label="anchor" href="#creating-your-own-database"></a>
</h2>
<p>If you don’t already have a database, here’s some advice from my
experiences setting up and running all of them. SQLite is by far the
easiest to get started with. PostgreSQL is not too much harder to use
and has a wide range of built-in functions. In my opinion, you shouldn’t
bother with MySQL/MariaDB: it’s a pain to set up, the documentation is
subpar, and it’s less featureful than Postgres. Google BigQuery might be
a good fit if you have very large data, or if you’re willing to pay (a
small amount of) money to someone who’ll look after your database.</p>
<p>All of these databases follow a client-server model - a computer that
connects to the database and the computer that is running the database
(the two may be one and the same but usually isn’t). Getting one of
these databases up and running is beyond the scope of this article, but
there are plenty of tutorials available on the web.</p>
<div class="section level3">
<h3 id="mysqlmariadb">MySQL/MariaDB<a class="anchor" aria-label="anchor" href="#mysqlmariadb"></a>
</h3>
<p>In terms of functionality, MySQL lies somewhere between SQLite and
PostgreSQL. It provides a wider range of <a href="http://dev.mysql.com/doc/refman/5.0/en/functions.html" class="external-link">built-in
functions</a>. It gained support for window functions in 2018.</p>
</div>
<div class="section level3">
<h3 id="postgresql">PostgreSQL<a class="anchor" aria-label="anchor" href="#postgresql"></a>
</h3>
<p>PostgreSQL is a considerably more powerful database than SQLite. It
has a much wider range of <a href="http://www.postgresql.org/docs/current/static/functions.html" class="external-link">built-in
functions</a>, and is generally a more featureful database.</p>
</div>
<div class="section level3">
<h3 id="bigquery">BigQuery<a class="anchor" aria-label="anchor" href="#bigquery"></a>
</h3>
<p>BigQuery is a hosted database server provided by Google. To connect,
you need to provide your <code>project</code>, <code>dataset</code> and
optionally a project for <code>billing</code> (if billing for
<code>project</code> isn’t enabled).</p>
<p>It provides a similar set of functions to Postgres and is designed
specifically for analytic workflows. Because it’s a hosted solution,
there’s no setup involved, but if you have a lot of data, getting it to
Google can be an ordeal (especially because upload support from R is not
great currently). (If you have lots of data, you can <a href="https://cloud.google.com/storage-transfer-service" class="external-link">ship hard
drives</a>!)</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, Maximilian Girlich, Edgar Ruiz, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

  </div></footer>
</body>
</html>
