% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/build-sql.R
\name{glue_sql2}
\alias{glue_sql2}
\title{Build SQL strings with glue syntax}
\usage{
glue_sql2(con, sql, envir = parent.frame())
}
\arguments{
\item{con}{A database connection.}

\item{sql}{A string to interpolate.}

\item{envir}{Environment to evaluate \code{sql} in.}
}
\value{
An SQL string.
}
\description{
\code{glue_sql2()} is a SQL string builder that uses \code{\link[glue:glue]{glue::glue()}} syntax with
special type markers for safe SQL generation. It replaces the deprecated
\code{\link[=build_sql]{build_sql()}} function with a more explicit and type-safe approach.

The default glue syntax, \code{{x}}, will escape the \code{x} using the
database connection. If there are multiple values in \code{x}, they'll be
collapsed into a single string with \verb{,}. If you want them to be wrapped in
\verb{()}, use a \code{*} suffix, e.g. \verb{\{x*\}}.

You can also use a type markers to control how the value is treated:
\itemize{
\item \verb{\{.sql x\}}: \code{x} is literal SQL that should be interpolated as
is, without additional escaping.
\item \verb{\{.tbl x\}}: \code{x} is a table identifier like a string, \code{I()}, or one of
the older forms like  \code{DBI::Id()} or \code{in_schema()}.
\item \verb{\{.id x\}}: \code{x} is an generic identifiers like for a column or index.
}
}
\examples{
con <- simulate_dbi()

tbl <- "my_table"
glue_sql2(con, "SELECT * FROM {.tbl tbl}")

# Values are properly escaped
name <- "Robert'); DROP TABLE students;--"
glue_sql2(con, "INSERT INTO students (name) VALUES ({name})")

# Control wrapping with *
x <- c("name", "age", "grade")
glue_sql2(con, "SELECT {.id x} FROM students")
glue_sql2(con, "SELECT * WHERE variable IN {x*}")
}
